import{b0 as z,aj as O,u as k,g as G,cs as H,r as Q,cz as Y,cm as q,j as s,P as r,M as U,ab as _,eA as J,c2 as c,eB as h,H as f,eC as K,et as W,eu as S,aT as X,i as Z,cj as $,ck as ss,d as ts,eD as es}from"./strapi-C46Ei97l.js";import{a as as,F as P}from"./Input-BR5JpzSp-Cy327Nkl.js";import"./Relations-B6iGFlMU-D57YXdAP.js";import"./relations-ksVp_JdY-CnGnbpJo.js";import"./usePrev-Bjw2dhmq-DwXCc7fj.js";import"./useDragAndDrop-HYwNDExe-BsEk8btt.js";import"./objects-wl73iEma-Df54r10I.js";import"./ComponentIcon-BZcTc4rj-CcpHVXS3.js";import"./getEmptyImage-CjqolaH3.js";const is=t=>Q.useEffect(t,ns),ns=[],os=()=>{const t=z(),[{query:{status:a}},i]=O({status:"draft"}),{formatMessage:n}=k(),{toggleNotification:o}=G(),{document:j,meta:d,isLoading:T,schema:l,components:x,collectionType:v,id:C,model:D,hasError:I,getTitle:b,getInitialFormValues:A}=H(),u=l?.options?.draftAndPublish??!1;is(()=>{t?.state&&"error"in t.state&&o({type:"danger",message:t.state.error,timeout:5e3})});const R=Y("EditViewPage",e=>e.isLoading),m=!C&&!(v===es),{isLoading:V,edit:{layout:y,settings:{mainField:L}}}=q(D),{isLazyLoading:F}=as([]),M=R||T||V||F,g=A(m);if(M&&!j?.documentId)return s.jsx(r.Loading,{});if(!g||I)return s.jsx(r.Error,{});const B=e=>{(e==="published"||e==="draft")&&i({status:e},"push",!0)},N=(e,p)=>S(l?.attributes,x,{status:a,...p}).validateSync(e,{abortEarly:!1});return s.jsxs(U,{paddingLeft:10,paddingRight:10,children:[s.jsx(r.Title,{children:b(L)}),s.jsx(_,{disabled:u&&a==="published",initialValues:g,method:m?"POST":"PUT",validate:(e,p)=>S(l?.attributes,x,{status:a,...p}).validate(e,{abortEarly:!1}),initialErrors:t?.state?.forceValidation?N(g,{}):{},children:({resetForm:e})=>s.jsxs(s.Fragment,{children:[s.jsx(J,{isCreating:m,status:u?rs(j,d):void 0,title:b(L)}),s.jsxs(c.Root,{variant:"simple",value:a,onValueChange:B,children:[s.jsx(c.List,{"aria-label":n({id:h("containers.edit.tabs.label"),defaultMessage:"Document status"}),children:u?s.jsxs(s.Fragment,{children:[s.jsx(E,{value:"draft",children:n({id:h("containers.edit.tabs.draft"),defaultMessage:"draft"})}),s.jsx(E,{disabled:!d||d.availableStatus.length===0,value:"published",children:n({id:h("containers.edit.tabs.published"),defaultMessage:"published"})})]}):null}),s.jsxs(f.Root,{paddingTop:8,gap:4,children:[s.jsxs(f.Item,{col:9,s:12,direction:"column",alignItems:"stretch",children:[s.jsx(c.Content,{value:"draft",children:s.jsx(P,{layout:y})}),s.jsx(c.Content,{value:"published",children:s.jsx(P,{layout:y})})]}),s.jsx(f.Item,{col:3,s:12,direction:"column",alignItems:"stretch",children:s.jsx(K,{})})]})]}),s.jsx(W,{onProceed:e})]})})]})},E=ts(c.Trigger)`
  text-transform: uppercase;
`,rs=(t,a)=>{const i=t?.status,n=a?.availableStatus??[];return i?i==="draft"&&n.find(o=>o.publishedAt!==null)?"published":i:"draft"},xs=()=>{const{slug:t=""}=X(),{permissions:a=[],isLoading:i,error:n}=Z($.map(o=>({action:o,subject:t})));return i?s.jsx(r.Loading,{}):n||!t?s.jsx(r.Error,{}):s.jsx(r.Protect,{permissions:a,children:({permissions:o})=>s.jsx(ss,{permissions:o,children:s.jsx(os,{})})})};export{os as EditViewPage,xs as ProtectedEditViewPage,rs as getDocumentStatus};
